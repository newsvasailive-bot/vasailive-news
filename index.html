<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Vasai Live News</title>
<script src="https://cdn.tailwindcss.com"></script>

<script type="module">
// --- Firebase Setup ---
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } 
  from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getDatabase, ref, set, push, onValue } 
  from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

// --- Config ---
const firebaseConfig = {
  apiKey: "AIzaSyC9tqZWhUN_cCdps9e81lsOezoqEZL2XJA",
  authDomain: "vasailive-news.firebaseapp.com",
  databaseURL: "https://vasailive-news-default-rtdb.firebaseio.com",
  projectId: "vasailive-news",
  storageBucket: "vasailive-news.appspot.com",
  messagingSenderId: "1033432728938",
  appId: "1:1033432728938:web:0c9f60a6c41205a56f5a5f"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

// --- DOM elements ---
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const noticeBoard = document.getElementById("noticeBoard");
const newsContainer = document.getElementById("newsContainer");
const modal = document.getElementById("modal");
const modalContent = document.getElementById("modalContent");
const modalClose = document.getElementById("modalClose");

// --- Auth ---
loginBtn.onclick = () => signInWithPopup(auth, provider);
logoutBtn.onclick = () => signOut(auth);

onAuthStateChanged(auth, user => {
  if (user) {
    loginBtn.classList.add("hidden");
    logoutBtn.classList.remove("hidden");
  } else {
    loginBtn.classList.remove("hidden");
    logoutBtn.classList.add("hidden");
  }
});

// --- Notice Board ---
onValue(ref(db, "notice"), snap => {
  noticeBoard.innerHTML = "";
  if (snap.exists()) {
    snap.forEach(n => {
      const div = document.createElement("div");
      div.className = "p-2 bg-yellow-100 border-b border-yellow-300 text-sm";
      div.textContent = n.val().text;
      noticeBoard.appendChild(div);
    });
  } else {
    noticeBoard.innerHTML = "<div class='p-2 text-gray-500 text-sm'>कोई सूचना नहीं</div>";
  }
});

// --- Load News Posts ---
onValue(ref(db, "posts"), snap => {
  newsContainer.innerHTML = "";
  if (!snap.exists()) {
    newsContainer.innerHTML = "<p class='text-gray-500'>अभी कोई पोस्ट नहीं है।</p>";
    return;
  }

  // Show 5 latest posts with auto-scroll
  const posts = [];
  snap.forEach(post => posts.unshift({ key: post.key, ...post.val() }));

  posts.slice(0, 5).forEach(d => {
    const img = d.image || "https://via.placeholder.com/600x300?text=No+Image";
    const txt = d.text ? d.text.slice(0, 150) + "..." : "";

    const card = document.createElement("div");
    card.className = "bg-white shadow rounded-lg overflow-hidden cursor-pointer hover:scale-[1.02] transition-transform duration-200";
    card.innerHTML = `
      <img src='${img}' class='w-full h-48 object-cover'>
      <div class='p-4'>
        <h3 class='text-lg font-semibold mb-2'>${d.title}</h3>
        <p class='text-gray-700 text-sm'>${txt.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</p>
      </div>`;
    card.onclick = () => openModal(d);
    newsContainer.appendChild(card);
  });

  autoScroll();
});

// --- Auto-scroll animation ---
function autoScroll() {
  let scrollPosition = 0;
  setInterval(() => {
    newsContainer.scrollTo({ top: scrollPosition, behavior: "smooth" });
    scrollPosition += 100;
    if (scrollPosition >= newsContainer.scrollHeight - newsContainer.clientHeight) {
      scrollPosition = 0;
    }
  }, 3000);
}

// --- Modal open ---
function openModal(data) {
  modal.classList.remove("hidden");
  modalContent.innerHTML = `
    <h2 class='text-xl font-bold mb-2'>${data.title}</h2>
    <img src='${data.image || "https://via.placeholder.com/600x300"}' class='rounded mb-4 w-full'>
  `;
  const p = document.createElement("p");
  p.className = "text-gray-800";
  p.textContent = data.text || "";
  modalContent.appendChild(p);
}

modalClose.onclick = () => modal.classList.add("hidden");
window.onclick = e => { if (e.target === modal) modal.classList.add("hidden"); };
</script>
</head>

<body class="bg-gray-50 text-gray-900 font-sans">
  <header class="bg-red-600 text-white p-4 flex justify-between items-center">
    <h1 class="text-xl font-bold">Vasai Live News</h1>
    <div>
      <button id="loginBtn" class="bg-white text-red-600 px-3 py-1 rounded">Google Login</button>
      <button id="logoutBtn" class="bg-white text-red-600 px-3 py-1 rounded hidden">Logout</button>
    </div>
  </header>

  <div id="noticeBoard" class="bg-yellow-50 border-b border-yellow-200 text-center text-sm"></div>

  <main class="p-4">
    <div id="newsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-[80vh] overflow-y-auto rounded-xl"></div>
  </main>

  <!-- Modal -->
  <div id="modal" class="hidden fixed inset-0 bg-black/60 flex justify-center items-center">
    <div class="bg-white w-11/12 md:w-2/3 lg:w-1/2 p-4 rounded-lg shadow-xl relative">
      <button id="modalClose" class="absolute top-2 right-2 text-gray-600 text-2xl">&times;</button>
      <div id="modalContent"></div>
    </div>
  </div>
</body>
</html>
