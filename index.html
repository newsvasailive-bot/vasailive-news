<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vasai Live News</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * {margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
    body {background:#0d0d0d;color:#fff;overflow-y:auto;scroll-behavior:smooth;}
    header {display:flex;justify-content:space-between;align-items:center;
      padding:10px 20px;background:#111;border-bottom:1px solid #333;position:sticky;top:0;z-index:1000;}
    h1 {font-size:1.5rem;}
    button {background:#ff1744;color:#fff;border:none;padding:8px 14px;border-radius:6px;cursor:pointer;transition:0.3s;}
    button:hover {background:#ff4569;}
    input[type="file"] {background:none;color:#ccc;margin-top:6px;}
    .container {padding:20px;max-width:900px;margin:auto;}
    .news-form {background:#1a1a1a;padding:20px;border-radius:10px;margin-bottom:20px;}
    .news-form input, .news-form textarea {
      width:100%;padding:10px;margin:8px 0;border:none;border-radius:6px;background:#2a2a2a;color:#fff;
    }
    textarea {height:120px;resize:vertical;overflow-y:auto;}
    .news-list {display:grid;gap:15px;}
    .card {background:#1a1a1a;padding:15px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.5);}
    .card img {width:100%;border-radius:10px;margin-bottom:10px;}
    .card-title {font-weight:600;font-size:1.1rem;margin-bottom:5px;}
    .card-content {font-size:0.95rem;line-height:1.5;color:#ddd;}
    .card .actions {display:flex;gap:10px;margin-top:10px;}
    .hidden {display:none;}
    .uploading {font-size:0.9rem;color:#ff9;}
    .preview-box {background:#101010;border:1px solid #333;border-radius:10px;padding:15px;margin-top:20px;}
    .preview-box img {width:100%;border-radius:10px;margin-top:10px;}
    .preview-title {font-size:1.2rem;font-weight:600;margin-bottom:6px;}
    .preview-content {font-size:0.95rem;color:#ccc;}
  </style>
</head>
<body>

  <header>
    <h1>üì∞ Vasai Live News</h1>
    <button id="loginBtn">Login with Google</button>
  </header>

  <div class="container">
    <div id="adminPanel" class="news-form hidden">
      <h2>üóûÔ∏è ‡§®‡§à ‡§®‡•ç‡§Ø‡•Ç‡§ú‡§º ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç / Edit</h2>
      <input type="text" id="title" placeholder="News Title" />
      <textarea id="content" placeholder="News Content..."></textarea>
      <input type="file" id="imageFile" accept="image/*" />
      <p id="uploadStatus" class="uploading hidden">‚è≥ Uploading image...</p>
      <button id="publishBtn">Publish News</button>
      <button id="updateBtn" class="hidden">Update News</button>

      <!-- ‚úÖ Live Preview -->
      <div id="previewBox" class="preview-box hidden">
        <div class="preview-title" id="previewTitle"></div>
        <div class="preview-content" id="previewContent"></div>
        <img id="previewImage" class="hidden" />
      </div>
    </div>

    <h2 style="margin-bottom:10px;">üì∞ Latest News</h2>
    <div class="news-list" id="newsList"></div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC9tqZWhUN_cCdps9e81lsOezoqEZL2XJA",
      authDomain: "vasailive-news.firebaseapp.com",
      projectId: "vasailive-news",
      storageBucket: "vasailive-news.firebasestorage.app",
      messagingSenderId: "527720941491",
      appId: "1:527720941491:web:9bd27e8bbc8f48b6b56dc6",
      measurementId: "G-Z85WP0D6N3"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    const loginBtn = document.getElementById('loginBtn');
    const publishBtn = document.getElementById('publishBtn');
    const updateBtn = document.getElementById('updateBtn');
    const adminPanel = document.getElementById('adminPanel');
    const newsList = document.getElementById('newsList');

    const titleField = document.getElementById('title');
    const contentField = document.getElementById('content');
    const imageFile = document.getElementById('imageFile');
    const uploadStatus = document.getElementById('uploadStatus');

    const previewBox = document.getElementById('previewBox');
    const previewTitle = document.getElementById('previewTitle');
    const previewContent = document.getElementById('previewContent');
    const previewImage = document.getElementById('previewImage');

    const ADMIN_EMAIL = "newsvasailive@gmail.com";
    let editId = null;
    let uploadedImageURL = "";

    // üîê Login
    loginBtn.addEventListener('click', () => {
      if (auth.currentUser) auth.signOut();
      else auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
    });

    auth.onAuthStateChanged(user => {
      if (user) {
        loginBtn.textContent = "Logout";
        if (user.email === ADMIN_EMAIL) adminPanel.classList.remove('hidden');
      } else {
        loginBtn.textContent = "Login with Google";
        adminPanel.classList.add('hidden');
      }
    });

    // üñºÔ∏è Upload image to Firebase Storage
    imageFile.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;
      uploadStatus.classList.remove('hidden');
      const storageRef = storage.ref(`news-images/${Date.now()}-${file.name}`);
      await storageRef.put(file);
      uploadedImageURL = await storageRef.getDownloadURL();
      uploadStatus.textContent = "‚úÖ Image uploaded successfully!";
      showPreview();
      setTimeout(() => uploadStatus.classList.add('hidden'), 2000);
    });

    // üì∞ Publish News
    publishBtn.addEventListener('click', async () => {
      const user = auth.currentUser;
      if (!user || user.email !== ADMIN_EMAIL) return alert("Only admin can publish!");
      const title = titleField.value.trim();
      const content = contentField.value.trim();
      if (!title || !content) return alert("Please fill all fields!");
      await db.collection('vasai_news').add({
        title, content, image: uploadedImageURL || "", createdAt: new Date()
      });
      clearForm();
    });

    // ‚úèÔ∏è Edit News
    window.editNews = (id, data) => {
      editId = id;
      titleField.value = data.title;
      contentField.value = data.content;
      uploadedImageURL = data.image || "";
      showPreview();
      publishBtn.classList.add('hidden');
      updateBtn.classList.remove('hidden');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    // üíæ Update News
    updateBtn.addEventListener('click', async () => {
      if (!editId) return;
      await db.collection('vasai_news').doc(editId).update({
        title: titleField.value.trim(),
        content: contentField.value.trim(),
        image: uploadedImageURL
      });
      clearForm();
    });

    // üßπ Clear
    function clearForm() {
      titleField.value = "";
      contentField.value = "";
      imageFile.value = "";
      uploadedImageURL = "";
      previewBox.classList.add('hidden');
      publishBtn.classList.remove('hidden');
      updateBtn.classList.add('hidden');
      editId = null;
    }

    // üîç Live Preview Function
    function showPreview() {
      const title = titleField.value.trim();
      const content = contentField.value.trim();
      previewTitle.textContent = title || "‚Äî Preview Title ‚Äî";
      previewContent.textContent = content || "‚Äî Content will appear here ‚Äî";
      if (uploadedImageURL) {
        previewImage.src = uploadedImageURL;
        previewImage.classList.remove('hidden');
      } else previewImage.classList.add('hidden');
      previewBox.classList.remove('hidden');
    }

    titleField.addEventListener('input', showPreview);
    contentField.addEventListener('input', showPreview);

    // üóëÔ∏è Delete
    window.deleteNews = async (id) => {
      if (confirm("Delete this news?")) await db.collection('vasai_news').doc(id).delete();
    };

    // üîÑ Load News
    function loadNews() {
      db.collection('vasai_news').orderBy('createdAt','desc').onSnapshot(snapshot => {
        newsList.innerHTML = "";
        snapshot.forEach(doc => {
          const news = doc.data();
          const card = document.createElement('div');
          card.className = "card";
          card.innerHTML = `
            ${news.image ? `<img src="${news.image}" alt="">` : ""}
            <div class="card-title">${news.title}</div>
            <div class="card-content">${news.content}</div>
            ${auth.currentUser && auth.currentUser.email === ADMIN_EMAIL
              ? `<div class="actions">
                   <button onclick='editNews("${doc.id}", ${JSON.stringify(news)})'>Edit</button>
                   <button onclick='deleteNews("${doc.id}")'>Delete</button>
                 </div>` : ""}
          `;
          newsList.appendChild(card);
        });
      });
    }

    loadNews();
  </script>

</body>
</html>
